import { GoogleGenerativeAI } from '@google/generative-ai';

/**
 * Initialize Gemini API client
 */
export function getGeminiClient() {
    const apiKey = process.env.GOOGLE_GEMINI_API_KEY;

    if (!apiKey) {
        throw new Error('GOOGLE_GEMINI_API_KEY is not set in environment variables');
    }

    return new GoogleGenerativeAI(apiKey);
}

/**
 * Build prompt based on content type, persona, and user input
 */
/**
 * Build a prompt based on content type, persona, user input, tone, audience, and refinement mode
 */
export function buildPrompt(contentType, persona, userInput, tone = 'casual', targetAudience = 'general', refinementMode = null, ragContext = null, hasImages = false) {
    // Tone descriptions
    const tones = {
        casual: '‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏™‡∏ö‡∏≤‡∏¢‡πÜ ‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥',
        professional: '‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠',
        playful: '‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡∏Ç‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô ‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ç‡∏±‡∏ô',
        warm: '‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏•‡∏¢‡∏≤‡∏ì‡∏°‡∏¥‡∏ï‡∏£ ‡πÉ‡∏™‡πà‡πÉ‡∏à',
        energetic: '‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô ‡πÄ‡∏£‡πâ‡∏≤‡πÉ‡∏à'
    };

    // Audience descriptions  
    const audiences = {
        general: '‡∏Ñ‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏ó‡∏∏‡∏Å‡πÄ‡∏û‡∏®‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏¢',
        teens: '‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô Gen Z (13-24 ‡∏õ‡∏µ) ‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢',
        adults: '‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (25-45 ‡∏õ‡∏µ) ‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û',
        seniors: '‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ (45+ ‡∏õ‡∏µ) ‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢',
        parents: '‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß ‡πÉ‡∏™‡πà‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå'
    };

    const toneDesc = tones[tone] || tones.casual;
    const audienceDesc = audiences[targetAudience] || audiences.general;

    // Refinement instructions
    let refinementInstruction = '';
    if (refinementMode === 'shorten') {
        refinementInstruction = '\n\n**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Priority): ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ "‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á" ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 50% ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏¢‡∏∑‡∏î‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏≠‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î**';
    } else if (refinementMode === 'lengthen') {
        refinementInstruction = '\n\n**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Priority): ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ "‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏∂‡πâ‡∏ô" ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (Storytelling) ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡πâ‡∏≤‡∏ß‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô**';
    } else if (refinementMode === 'regenerate') {
        refinementInstruction = '\n\n**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°**';
    }

    // Persona styles
    const personaStyles = {
        pa_meaw: {
            name: '‡∏õ‡πâ‡∏≤‡πÅ‡∏°‡∏ß',
            business: '‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏¢‡∏≥‡∏¢‡∏∞‡∏•‡∏≤',
            tone: '‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏†‡∏≤‡∏©‡∏≤‡πÉ‡∏ï‡πâ ‡πÄ‡∏ä‡πà‡∏ô "‡∏´‡∏£‡∏≠‡∏¢" "‡∏à‡∏±‡∏á‡∏Æ‡∏π‡πâ" "‡∏ï‡πä‡∏∞"',
            emoji: 'üå∂Ô∏èüç≤ü•¨',
            style: '‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£'
        },
        kanah_batik: {
            name: '‡∏Å‡∏∞‡∏ô‡∏∞‡∏´‡πå',
            business: '‡∏£‡πâ‡∏≤‡∏ô‡∏ú‡πâ‡∏≤‡∏ö‡∏≤‡∏ï‡∏¥‡∏Å OTOP',
            tone: '‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ù‡∏µ‡∏°‡∏∑‡∏≠',
            emoji: 'üé®‚ú®üßµ',
            style: '‡∏á‡∏≤‡∏°‡∏™‡∏á‡πà‡∏≤ ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå'
        },
        betong_tour: {
            name: '‡∏ö‡∏±‡∏á‡∏Æ‡∏≤‡∏£‡∏¥‡∏™',
            business: '‡πÑ‡∏Å‡∏î‡πå‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ö‡∏ï‡∏á',
            tone: '‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡∏ï‡∏¥‡∏î‡πÅ‡∏ã‡πà‡∏ö ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏≠‡∏±‡∏¢‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÄ‡∏ß‡∏á" "‡∏™‡∏ß‡∏¢‡∏ï‡∏∞‡πÇ‡∏Å‡∏ô"',
            emoji: '‚òÅÔ∏èüèîÔ∏èüì∏',
            style: '‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô ‡∏ô‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°'
        }
    };

    let currentPersona = personaStyles[persona] || {
        name: '‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢',
        business: '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à',
        tone: '‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£',
        emoji: '‚ú®',
        style: '‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û'
    };

    // Image Analysis Instructions
    let imageInstruction = '';
    if (hasImages) {
        console.log('üì∏ [GenAI] Adding image analysis instructions');
        imageInstruction = `\n\n=== ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ö‡∏°‡∏≤ (‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á) ===

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:**

1. üîç **‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ:**
   - ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ô‡∏£‡∏π‡∏õ (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®)
   - ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (‡∏™‡∏µ, ‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢, ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©)
   - ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏û (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á, ‡∏™‡∏µ, ‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á)

2. ‚úçÔ∏è **‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á:**
   - ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
   - ‡∏û‡∏£‡∏£‡∏ì‡∏ô‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á
   - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏î‡∏π‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å:**
- ‚ùå **‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏ß‡∏ô "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å**
- ‚ùå **‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏ß‡∏ô "‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏†‡∏≤‡∏û" ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å**
- ‚úÖ **‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô**
`;
    }

    // RAG Context Injection
    let ragInstruction = '';
    if (ragContext) {
        console.log('üß† [GenAI] Injecting RAG Context');

        // Override Persona with User Profile if available
        if (ragContext.profile && ragContext.profile.business_name) {
            currentPersona = {
                name: ragContext.profile.business_name,
                business: ragContext.profile.business_type || '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à',
                emoji: 'üè™',
                style: ragContext.profile.description || currentPersona.style
            };
        }

        ragInstruction = `\n\n=== ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô/‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (RAG Context) ===\n`;

        if (ragContext.profile) {
            if (ragContext.profile.description) ragInstruction += `- ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô: ${ragContext.profile.description}\n`;
            if (ragContext.profile.signature_menu) ragInstruction += `- ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡πá‡∏î/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${ragContext.profile.signature_menu}\n`;
            if (ragContext.profile.history) ragInstruction += `- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥/‡∏™‡∏ï‡∏≠‡∏£‡∏µ‡πà: ${ragContext.profile.history}\n`;
        }

        if (ragContext.documents && ragContext.documents.length > 0) {
            ragInstruction += `\n=== ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (Knowledge Base) ===\n`;
            ragContext.documents.forEach((doc, index) => {
                ragInstruction += `[‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà ${index + 1} - ${doc.filename}]: ${doc.content}\n`;
            });
        }

        ragInstruction += `\n**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**`;
    }

    // Base instructions
    const baseInstruction = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ${currentPersona.name} ‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£${currentPersona.business}
‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å: ${currentPersona.style}
Emoji ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${currentPersona.emoji}

‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:
- ‡πÇ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô: ${toneDesc}
- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${audienceDesc}${imageInstruction}${ragInstruction}`;

    // Content type specific prompts
    let specificPrompt = '';

    switch (contentType) {
        case 'caption':
            specificPrompt = `
‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏π‡∏õ/‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠:

‡πÇ‡∏à‡∏ó‡∏¢‡πå: "${userInput}"

‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ã‡∏∑‡πâ‡∏≠ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏≤‡∏£‡πâ‡∏≤‡∏ô
- ‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ç‡∏±‡∏ô ‡∏Ñ‡∏≥‡πÄ‡∏•‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏≥
- **‡∏à‡∏ö‡∏î‡πâ‡∏ß‡∏¢ hashtags 3-5 ‡∏ï‡∏±‡∏ß** ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô #‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏ï‡πâ #‡∏Ç‡∏≠‡∏á‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏¢‡∏∞‡∏•‡∏≤ #‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á)

‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î!
`;
            break;

        case 'promotion':
            specificPrompt = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: "${userInput}"

‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:
- ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${audienceDesc}"
- ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô "${toneDesc}" ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠
- ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠, ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç, ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤)
- ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏ã‡∏∑‡πâ‡∏≠ (Urgency)
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°`;
            break;

        case 'video':
            specificPrompt = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå/‡πÅ‡∏ú‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: "${userInput}"

‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:
- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á "${audienceDesc}" ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö "${toneDesc}"
- ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á: Headline (Hook), Intro, Body (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å), CTA (‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)
- ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏â‡∏≤‡∏Å
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°`;
            break;

        default:
            specificPrompt = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: "${userInput}"
             
‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:
- ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏ó‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô "${toneDesc}" ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö "${audienceDesc}"
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏≥`;
    }

    return `${baseInstruction}\n\n${specificPrompt}${refinementInstruction}\n\n**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (Clean text)**`;
}


/**
 * Generate content using Gemini API (Official SDK @google/generative-ai)
 * Supports multimodal input (text + images)
 */
export async function generateContent(prompt, images = []) {
    console.log('üìú [Gemini] FINAL PROMPT SENT TO API:\n', '----------------------------------------\n', prompt, '\n----------------------------------------');

    const hasImages = images && images.length > 0;
    if (hasImages) {
        console.log(`üñºÔ∏è [Gemini] Image analysis enabled: ${images.length} image(s)`);
    }

    try {
        // Use official SDK
        const { GoogleGenerativeAI } = await import('@google/generative-ai');

        const apiKey = process.env.GOOGLE_GEMINI_API_KEY;

        if (!apiKey) {
            throw new Error('GOOGLE_GEMINI_API_KEY is not set in environment variables');
        }

        const genAI = new GoogleGenerativeAI(apiKey);

        console.log('üåê [Gemini] Using official @google/generative-ai SDK');

        // Vision-capable models (for multimodal input with v1beta API)
        const modelsToTry = hasImages ? [
            'gemini-3-flash-preview',  // Primary model for vision + text
            'gemini-2.5-flash',        // Fallback: Fast and capable multimodal
            'gemini-2.5-pro',          // Fallback: High capability multimodal
            'gemini-3-pro-preview'     // Fallback: Newest pro model
        ] : [
            'gemini-3-flash-preview',  // Primary model for text-only
            'gemini-2.5-flash',        // Fallback: Fastest
            'gemini-2.5-pro',
            'gemini-3-pro-preview'
        ];

        let lastError = null;

        for (const modelName of modelsToTry) {
            try {
                console.log(`üîç Trying model: ${modelName}`);

                const model = genAI.getGenerativeModel({ model: modelName });

                let result;

                if (hasImages) {
                    // Multimodal request (text + images)
                    const parts = [{ text: prompt }];

                    // Add images as inline data
                    for (let i = 0; i < images.length; i++) {
                        const imageData = images[i];
                        console.log(`üñºÔ∏è [Gemini] Processing image ${i + 1}:`, {
                            mimeType: imageData.mimeType,
                            dataLength: imageData.data?.length || 0
                        });

                        parts.push({
                            inlineData: {
                                mimeType: imageData.mimeType,
                                data: imageData.data
                            }
                        });
                    }

                    result = await model.generateContent(parts);
                } else {
                    // Text-only request
                    result = await model.generateContent(prompt);
                }

                const response = await result.response;
                const text = response.text();

                console.log(`‚úÖ [Gemini] Success with model: ${modelName}`);
                return text;

            } catch (error) {
                console.log(`‚ùå ${modelName} failed:`, error.message);
                lastError = error;
                continue; // Try next model
            }
        }

        // All models failed, throw last error
        throw lastError || new Error('All models failed');

    } catch (error) {
        console.error('Gemini API Error:', error);
        console.warn('‚ö†Ô∏è [Gemini] Using mock data fallback');

        // Mock data fallback - determine type from prompt
        const isCaptionPrompt = prompt.toLowerCase().includes('‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô');
        const isPromotionPrompt = prompt.toLowerCase().includes('‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô');
        const isVideoPrompt = prompt.toLowerCase().includes('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠');

        if (isCaptionPrompt) {
            return `üìù ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î! üå∂Ô∏è‚ú®

‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏ô ‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ñ‡∏∂‡∏á‡πÉ‡∏à ‡∏ó‡∏≥‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° 
‡∏°‡∏≤‡∏•‡∏≠‡∏á‡∏ä‡∏¥‡∏°‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô! üç≤üíö

üìç ‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
üìû ‡πÇ‡∏ó‡∏£: 08X - XXX - XXXX

#‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏£‡πà‡∏≠‡∏¢ #‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ #‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á #‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ #‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏î‡πá‡∏î

‚ö†Ô∏è ** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á(Gemini API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)`;
        } else if (isPromotionPrompt) {
            return `üéâ ** ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°! ** üéâ

üì¢ ** ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50 %**

‚ú® ** ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì:**
‚Ä¢ ‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡πÅ‡∏ñ‡∏° 1 ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π
‚Ä¢ ‡∏•‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° 10 % ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥
‚Ä¢ ‡∏ü‡∏£‡∏µ! ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° 1 ‡πÅ‡∏Å‡πâ‡∏ß

üìû ** ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢:** 08X - XXX - XXXX
‚è∞ ** ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** ‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!

#‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô #‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ #‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î #‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°

‚ö†Ô∏è ** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á(Gemini API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)`;
        } else if (isVideoPrompt) {
            return `üé¨ ** ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏õ:** ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©!

üìù ** ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠:**
    ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ!

üé• ** ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≥:**
üìç Scene 1: ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞ Hook(15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    - ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î
    - ‡∏û‡∏π‡∏î‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à

üìç Scene 2: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô(30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    - ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ / ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥
    - ‡πÄ‡∏ô‡πâ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô

üìç Scene 3: Call - to - Action(15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    - ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏ä‡∏ß‡∏ô‡∏•‡∏≠‡∏á
    - ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠

üí¨ ** ‡∏ö‡∏ó‡∏û‡∏π‡∏î / Script:**
    "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞! ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ [‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤] ‡∏™‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏à‡∏≤‡∏Å [‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö] ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÄ‡∏î‡πá‡∏î ‡∏°‡∏≤‡∏•‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞!"

#Ô∏è‚É£ ** Hashtags ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
    #‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏£‡∏µ‡∏ß‡∏¥‡∏ß #‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ #‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î #‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ #‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏î‡πá‡∏î #‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏î‡∏µ #‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á

‚ö†Ô∏è ** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á(Gemini API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)`;
        } else {
            return `‚ú® ** ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ **

    ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö

üìù ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå ‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢ ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à

‚ö†Ô∏è ** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gemini API Key`;
        }
    }
}
