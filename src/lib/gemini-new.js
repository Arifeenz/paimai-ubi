/**
 * Generate content using Gemini API (New SDK @google/genai)
 */
export async function generateContent(prompt, images = []) {
    try {
        // Use new SDK
        const { GoogleGenAI } = await import('@google/genai');

        const apiKey = process.env.GOOGLE_GEMINI_API_KEY;

        if (!apiKey) {
            throw new Error('GOOGLE_GEMINI_API_KEY is not set in environment variables');
        }

        const ai = new GoogleGenAI({ apiKey });

        console.log('üåê [Gemini] Using new SDK');

        // Try different models in order of preference
        const modelsToTry = [
            'gemini-2.0-flash-exp',
            'gemini-1.5-flash',
            'gemini-1.5-pro',
            'gemini-pro'
        ];

        let lastError = null;

        for (const modelName of modelsToTry) {
            try {
                console.log(`üîç Trying model: ${modelName}`);

                const response = await ai.models.generateContent({
                    model: modelName,
                    contents: prompt
                });

                const text = response.text;
                console.log(`‚úÖ [Gemini] Success with model: ${modelName}`);

                return text;
            } catch (error) {
                console.log(`‚ùå ${modelName} failed:`, error.message);
                lastError = error;
                continue; // Try next model
            }
        }

        // All models failed, throw last error
        throw lastError || new Error('All models failed');

    } catch (error) {
        console.error('Gemini API Error:', error);
        console.warn('‚ö†Ô∏è [Gemini] Using mock data fallback');

        // Mock data fallback - determine type from prompt
        const isCaptionPrompt = prompt.toLowerCase().includes('‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô');
        const isPromotionPrompt = prompt.toLowerCase().includes('‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô');
        const isVideoPrompt = prompt.toLowerCase().includes('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠');

        if (isCaptionPrompt) {
            return `üìù ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î! üå∂Ô∏è‚ú®

‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏ô ‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ñ‡∏∂‡∏á‡πÉ‡∏à ‡∏ó‡∏≥‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° 
‡∏°‡∏≤‡∏•‡∏≠‡∏á‡∏ä‡∏¥‡∏°‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô! üç≤üíö

üìç ‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
üìû ‡πÇ‡∏ó‡∏£: 08X-XXX-XXXX

#‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏£‡πà‡∏≠‡∏¢ #‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ #‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á #‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ #‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏î‡πá‡∏î

‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (Gemini API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)`;
        } else if (isPromotionPrompt) {
            return `üéâ **‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°!** üéâ

üì¢ **‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50%**

‚ú® **‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì:**
‚Ä¢ ‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡πÅ‡∏ñ‡∏° 1 ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π
‚Ä¢ ‡∏•‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° 10% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥
‚Ä¢ ‡∏ü‡∏£‡∏µ! ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° 1 ‡πÅ‡∏Å‡πâ‡∏ß

üìû **‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢:** 08X-XXX-XXXX
‚è∞ **‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** ‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!

#‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô #‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ #‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î #‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°

‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (Gemini API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)`;
        } else if (isVideoPrompt) {
            return `üé¨ **‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏õ:** ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©!

üìù **‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠:**
‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ!

üé• **‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≥:**
üìç Scene 1: ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞ Hook (15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
   - ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î
   - ‡∏û‡∏π‡∏î‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à

üìç Scene 2: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
   - ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥/‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥
   - ‡πÄ‡∏ô‡πâ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô

üìç Scene 3: Call-to-Action (15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
   - ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏ä‡∏ß‡∏ô‡∏•‡∏≠‡∏á
   - ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠

üí¨ **‡∏ö‡∏ó‡∏û‡∏π‡∏î/Script:**
"‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞! ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ [‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤] ‡∏™‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏à‡∏≤‡∏Å [‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö] ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÄ‡∏î‡πá‡∏î ‡∏°‡∏≤‡∏•‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞!"

#Ô∏è‚É£ **Hashtags ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
#‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏£‡∏µ‡∏ß‡∏¥‡∏ß #‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ #‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏•‡∏≤‡∏î #‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ #‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏î‡πá‡∏î #‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏î‡∏µ #‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á

‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (Gemini API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)`;
        } else {
            return `‚ú® **‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ**

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö

üìù ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå ‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢ ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à

‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gemini API Key`;
        }
    }
}
